#!/bin/bash
#
# [AetherFlow :: Install FlareSolverr]
# Proxy server to bypass Cloudflare and DDoS-GUARD
#
# Author : McEveritts
# URL    : https://AetherFlow.io
# License: GPL-3.0
#
set -e

LOGFILE="/opt/AetherFlow/logs/installer.log"
mkdir -p /opt/AetherFlow/logs /install

log() { echo "[$(date '+%Y-%m-%d %H:%M:%S')] [flaresolverr] $1" | tee -a "$LOGFILE"; }

# ── Install Docker if not present ────────────────────────────────────────────
if ! command -v docker &>/dev/null; then
    log "Docker not found — installing Docker Engine..."
    curl -fsSL https://get.docker.com | sh >>"$LOGFILE" 2>&1
    systemctl enable docker >>"$LOGFILE" 2>&1
    systemctl start docker
fi

# ── Deploy FlareSolverr container ────────────────────────────────────────────
log "Pulling and starting FlareSolverr container..."
docker rm -f flaresolverr 2>/dev/null || true
docker run -d \
    --name flaresolverr \
    --restart=always \
    -p 8191:8191 \
    -e LOG_LEVEL=info \
    -e TZ=America/New_York \
    ghcr.io/flaresolverr/flaresolverr:latest >>"$LOGFILE" 2>&1

# ── Finalize ─────────────────────────────────────────────────────────────────
touch /install/.flaresolverr.lock
log "FlareSolverr installation complete! API at http://your-server:8191"
