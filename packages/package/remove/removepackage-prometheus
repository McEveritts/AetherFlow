#!/bin/bash
#
# [AetherFlow :: Remove prometheus]
#
source /opt/AetherFlow/packages/common.sh
set -e

LOGFILE="/opt/AetherFlow/logs/installer.log"
log() { echo "[$(date '+%Y-%m-%d %H:%M:%S')] [remove-prometheus] $1" | tee -a "$LOGFILE"; }

log "Stopping prometheus..."
systemctl stop prometheus node_exporter; systemctl disable prometheus node_exporter

log "Removing prometheus files and configuration..."
rm -rf /opt/prometheus /etc/prometheus /var/lib/prometheus /etc/systemd/system/prometheus.service /etc/systemd/system/node_exporter.service /etc/apache2/sites-enabled/prometheus.conf; userdel prometheus 2>/dev/null

systemctl daemon-reload 2>/dev/null
service apache2 reload 2>/dev/null
rm -f /install/.prometheus.lock

log "prometheus has been completely removed."